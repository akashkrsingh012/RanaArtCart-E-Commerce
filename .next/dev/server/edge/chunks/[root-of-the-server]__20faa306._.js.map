{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 16, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/handmade-arts-e-commerce/middleware.js"],"sourcesContent":["import { NextResponse } from \"next/server\"\nimport { jwtVerify } from \"jose\"\n\nexport async function middleware(request) {\n  const { pathname } = request.nextUrl\n\n  // Exclude API routes from middleware checks (they handle their own auth)\n  if (pathname.startsWith(\"/api/\")) {\n    return NextResponse.next()\n  }\n\n  const isUserProtected = pathname.startsWith(\"/private\")\n  const isSellerProtected =\n    pathname.startsWith(\"/seller\") &&\n    !pathname.startsWith(\"/seller/login\") &&\n    !pathname.startsWith(\"/seller/register\")\n\n  if (!isUserProtected && !isSellerProtected) {\n    return NextResponse.next()\n  }\n\n  const refreshCookieName = isSellerProtected ? \"sellerRefreshToken\" : \"refreshToken\"\n  const redirectUrl = isSellerProtected ? \"/seller/login\" : \"/login\"\n  const jwtSecretStr = isSellerProtected ? process.env.JWT_SECRET : process.env.JWT_SECRET\n  const jwtRefreshSecretStr = isSellerProtected ? process.env.JWT_REFRESH_SECRET : process.env.JWT_REFRESH_SECRET\n\n  const jwtSecret = new TextEncoder().encode(jwtSecretStr)\n  const jwtRefreshSecret = new TextEncoder().encode(jwtRefreshSecretStr)\n\n  // Check for refreshToken cookie first\n  const refreshToken = request.cookies.get(refreshCookieName)?.value\n\n  // If refreshToken exists, verify it\n  if (refreshToken) {\n    try {\n      const { payload } = await jwtVerify(refreshToken, jwtRefreshSecret)\n      const response = NextResponse.next()\n      // Refresh the cookie\n      response.cookies.set(refreshCookieName, refreshToken, {\n        httpOnly: true,\n        secure: process.env.NODE_ENV === \"production\",\n        sameSite: \"strict\",\n        path: \"/\",\n        maxAge: 60 * 60 * 24 * 7,\n      })\n      response.headers.set(\"x-user-id\", payload.sub || \"\")\n      return response\n    } catch (error) {\n      console.error(\"Middleware refreshToken verification failed\", error)\n      // Fall through to check accessToken\n    }\n  }\n\n  // If no refreshToken or invalid, check for accessToken in Authorization header\n  const authHeader = request.headers.get(\"authorization\")\n  const bearerToken = authHeader?.startsWith(\"Bearer \") ? authHeader.split(\" \")[1] : null\n\n  if (bearerToken) {\n    try {\n      const { payload } = await jwtVerify(bearerToken, jwtSecret)\n      const response = NextResponse.next()\n      response.headers.set(\"x-user-id\", payload.sub || \"\")\n      return response\n    } catch (error) {\n      console.error(\"Middleware accessToken verification failed\", error)\n      // Fall through to redirect\n    }\n  }\n\n  // No valid token found, redirect to login\n  return NextResponse.redirect(new URL(redirectUrl, request.url))\n}\n\nexport const config = {\n  matcher: [\"/private/:path*\", \"/seller/:path*\"],\n}\n\n\n\n"],"names":[],"mappings":";;;;;;AAAA;AAAA;AACA;;;AAEO,eAAe,WAAW,OAAO;IACtC,MAAM,EAAE,QAAQ,EAAE,GAAG,QAAQ,OAAO;IAEpC,yEAAyE;IACzE,IAAI,SAAS,UAAU,CAAC,UAAU;QAChC,OAAO,qOAAY,CAAC,IAAI;IAC1B;IAEA,MAAM,kBAAkB,SAAS,UAAU,CAAC;IAC5C,MAAM,oBACJ,SAAS,UAAU,CAAC,cACpB,CAAC,SAAS,UAAU,CAAC,oBACrB,CAAC,SAAS,UAAU,CAAC;IAEvB,IAAI,CAAC,mBAAmB,CAAC,mBAAmB;QAC1C,OAAO,qOAAY,CAAC,IAAI;IAC1B;IAEA,MAAM,oBAAoB,oBAAoB,uBAAuB;IACrE,MAAM,cAAc,oBAAoB,kBAAkB;IAC1D,MAAM,eAAe,oBAAoB,QAAQ,GAAG,CAAC,UAAU,GAAG,QAAQ,GAAG,CAAC,UAAU;IACxF,MAAM,sBAAsB,oBAAoB,QAAQ,GAAG,CAAC,kBAAkB,GAAG,QAAQ,GAAG,CAAC,kBAAkB;IAE/G,MAAM,YAAY,IAAI,cAAc,MAAM,CAAC;IAC3C,MAAM,mBAAmB,IAAI,cAAc,MAAM,CAAC;IAElD,sCAAsC;IACtC,MAAM,eAAe,QAAQ,OAAO,CAAC,GAAG,CAAC,oBAAoB;IAE7D,oCAAoC;IACpC,IAAI,cAAc;QAChB,IAAI;YACF,MAAM,EAAE,OAAO,EAAE,GAAG,MAAM,IAAA,iNAAS,EAAC,cAAc;YAClD,MAAM,WAAW,qOAAY,CAAC,IAAI;YAClC,qBAAqB;YACrB,SAAS,OAAO,CAAC,GAAG,CAAC,mBAAmB,cAAc;gBACpD,UAAU;gBACV,QAAQ,oDAAyB;gBACjC,UAAU;gBACV,MAAM;gBACN,QAAQ,KAAK,KAAK,KAAK;YACzB;YACA,SAAS,OAAO,CAAC,GAAG,CAAC,aAAa,QAAQ,GAAG,IAAI;YACjD,OAAO;QACT,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC,+CAA+C;QAC7D,oCAAoC;QACtC;IACF;IAEA,+EAA+E;IAC/E,MAAM,aAAa,QAAQ,OAAO,CAAC,GAAG,CAAC;IACvC,MAAM,cAAc,YAAY,WAAW,aAAa,WAAW,KAAK,CAAC,IAAI,CAAC,EAAE,GAAG;IAEnF,IAAI,aAAa;QACf,IAAI;YACF,MAAM,EAAE,OAAO,EAAE,GAAG,MAAM,IAAA,iNAAS,EAAC,aAAa;YACjD,MAAM,WAAW,qOAAY,CAAC,IAAI;YAClC,SAAS,OAAO,CAAC,GAAG,CAAC,aAAa,QAAQ,GAAG,IAAI;YACjD,OAAO;QACT,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC,8CAA8C;QAC5D,2BAA2B;QAC7B;IACF;IAEA,0CAA0C;IAC1C,OAAO,qOAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,aAAa,QAAQ,GAAG;AAC/D;AAEO,MAAM,SAAS;IACpB,SAAS;QAAC;QAAmB;KAAiB;AAChD"}}]
}